---
title: "linearGR_Models"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)

library(lme4)
library(caret)
library(tidyverse)
```

```{r load data}

load(file = paste0('D:/projects/linkedModels/data/out/dG_bktbntats1997_forLmer.RData')) # made by running mainAnalysis_Nimble.R with speciesGr = c("bkt", "bnt","ats") through ddG[[ii]] <- dddG[[ii]] %>% prepareDataForJags("growth")

d2 <- data.frame(
  #sampleNumber=ddG[[1]][[2]]$sampleNumber,
  
  ind=ddG[[1]][[1]]$ind,
  river=ddG[[1]][[1]]$riverDATA,
  season=ddG[[1]][[1]]$season,
  year=ddG[[1]][[1]]$year,
  species=ddG[[1]][[1]]$species,
  sampleNumber=ddG[[1]][[1]]$sampleNumber,
  isYOY=ddG[[1]][[1]]$isYOYDATA,
  length=ddG[[1]][[1]]$lengthDATAStd,
  lengthByYear=ddG[[1]][[1]]$lengthDATAStd_ByYOY_Year,
  grLength=ddG[[1]][[1]]$grNotUse,
  tempStd=ddG[[1]][[1]]$tempStd,
  flowStd=ddG[[1]][[1]]$flowStd,
  countPStd=ddG[[1]][[1]]$countPAllSppStd,

  countPStdBKT=ddG[[1]][[1]]$countPStdBKT,
  countPStdBNT=ddG[[1]][[1]]$countPStdBNT,
  countPStdATS=ddG[[1]][[1]]$countPStdATS,
  
  countPBKT=ddG[[1]][[1]]$cBKTStd,
  countPBNT=ddG[[1]][[1]]$cBNTStd,
  countPATS=ddG[[1]][[1]]$cATSStd,
  
  ATS01DATA=ddG[[1]][[1]]$ATS01DATA
  )

d <- d2 %>% filter(
  #  species == as.numeric(speciesInGr),
    !is.na(grLength),
    !is.na(countPStd) #removes 5 obs
  )

d <- d %>% mutate( tempStd2 = tempStd^2, 
                   flowStd2 = flowStd^2, 
                   countPStd2 = countPStd^2, 
                   length2 = length^2, lengthByYear2 = lengthByYear^2,
                   countPStdBKT2 = countPStdBKT^2,
                   countPStdBNT2 = countPStdBNT^2,
                   countPStdATS2 = countPStdATS^2,
                   isYOY = as.factor(isYOY), season = as.factor(season), 
                   river = as.factor(river), species = as.factor(species)
                   
                 )
d$grLength <- ifelse(d$species == 2 & d$river == 3, NA, d$grLength)
d$grLength <- ifelse(d$species %in% c('2','3') & d$isYOY == 1 & d$season == "2", NA, d$grLength)
d$grLength <- ifelse(d$grLength < -0.025, NA, d$grLength)

d <- d %>%
  mutate(
    cBKTStd = as.numeric(scale(countPBKT)),
    cBNTStd = as.numeric(scale(countPBNT)),
    cATSStd = as.numeric(scale(countPATS)),
    cBKTStd2 = cBKTStd^2,
    cBNTStd2 = cBNTStd^2,
    cATSStd2 = cATSStd^2
  )

#turn off very low densities of ATS in jimmy 
#d$cATSStd <- ifelse(d$river %in% c('2') , NA, d$cATSStd)
#d$cATSStd2 <- ifelse(d$river %in% c('2') , NA, d$cATSStd2)

mod <- list()

bySpecies <- d %>% 
  filter( species %in% c(1,2,3) ) %>%
  group_by(species) %>% 
  nest()

# turn factor off for ATS so the models run for all three spp
bySpecies$data[[3]]$river <- as.numeric(bySpecies$data[[3]]$river)


```

```{r}
# -2.5 values are mostly from season==2 and isYOY==1
ggplot(d, aes(sampleNumber,cBKTStd)) + geom_point() + geom_line() + facet_grid(season~river)
ggplot(d, aes(sampleNumber,cBNTStd)) + geom_point() + geom_line() + facet_grid(season~river)
ggplot(d, aes(sampleNumber,cATSStd)) + geom_point() + geom_line() + facet_grid(season~river)

ggplot(d, aes(sampleNumber,cATSStd)) + geom_point() + geom_line() + facet_wrap(~river)

```

```{r}

ggplot(d, aes(sampleNumber,grLength)) + geom_point()  + facet_grid(species~river+season)

ggplot(d, aes(cBKTStd,grLength)) + geom_point()  + facet_grid(species~river+season)
ggplot(d, aes(cBNTStd,grLength)) + geom_point()  + facet_grid(species~river+season)
ggplot(d, aes(cATSStd,grLength)) + geom_point()  + facet_grid(species~river+season)

```

```{r}
pairs(d[,c('countPStd','countPStdBKT_01','countPStdBNT_01','countPStdATS_01')])
pairs(d[,c('countPBKT','countPBNT','countPATS')])
pairs(d[,c('cBKTStd','cBNTStd','cATSStd','tempStd','flowStd')])
pairs(d[,c('tempStd2','flowStd2','tempStd','flowStd')])
d20 <- d
d20[d20 == -2.5] <- NA
pairs(d20[,c('countPStd','countPStdBKT','countPStdBNT','countPStdATS')])
round(cor(d20[,c('countPStd','countPStdBKT','countPStdBNT','countPStdATS')], use="complete.obs"),2)
```


Try new, more flexible model structure

```{r}


mod[[1]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   (1|ind), data = df ) }

mod[[2]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd + 
                   lengthByYear  +
                   (1|ind), data = df ) } 

mod[[3]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd   +
                   isYOY * lengthByYear  +
                   (1|ind), data = df ) } 
# 3 is better for bkt

# need squared term for flow or temp?
mod[[4]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear  +
                   isYOY * river * season * tempStd2 + 
                   isYOY * river * season * flowStd2  +
                   (1|ind), data = df ) } 

mod[[5]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear  +
                   isYOY * river * season * tempStd2 * flowStd2  +
                   (1|ind), data = df ) } 

mod[[6]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear  +
                   isYOY * river * season * tempStd2 + 
                   (1|ind), data = df ) } 

mod[[7]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear  +
                   isYOY * river * season * flowStd2  +
                   (1|ind), data = df ) } 
# 3 is best for bkt, bnt
# 5 is best for ATS
```
        rowname  df       AIC     rowname.1 df.1     AIC.1     rowname.2 df.2     AIC.2
1 o$model3[[1]] 132 -24138.75 o$model3[[2]]   60 -11185.96 o$model5[[3]]   53 -27273.26
2 o$model1[[1]] 130 -24066.23 o$model7[[2]]   74 -11185.65 o$model4[[3]]   46 -27271.94
3 o$model2[[1]] 131 -24051.02 o$model6[[2]]   74 -11140.56 o$model7[[3]]   39 -26891.76
4 o$model6[[1]] 164 -24031.80 o$model4[[2]]   88 -11113.99 o$model6[[3]]   39 -26866.52
5 o$model5[[1]] 226 -23972.19 o$model1[[2]]   58 -11093.02 o$model3[[3]]   32 -26711.17
6 o$model7[[1]] 164 -23945.62 o$model2[[2]]   59 -11076.95 o$model1[[3]]   30 -26675.04
7 o$model4[[1]] 196 -23919.37 o$model5[[2]]  102 -11021.51 o$model2[[3]]   31 -26664.86

```{r}

mod[[8]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd   +
                   isYOY * lengthByYear  +
                   isYOY * season * cBKTStd +
                   (1|ind), data = df ) }

mod[[9]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd   +
                   isYOY * lengthByYear  +
                   isYOY * season * cBNTStd +
                   (1|ind), data = df ) }

mod[[10]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd   +
                   isYOY * lengthByYear  +
                   isYOY *         season * cATSStd +
                   (1|ind), data = df ) }

mod[[11]] <- function(df) {
 lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                  isYOY * lengthByYear  +
                  isYOY * river * season * cBKTStd +
                  isYOY * river * season * cBNTStd +
                  isYOY *         season * cATSStd +
                  (1|ind), data = df ) }

mod[[12]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear  +
                   isYOY * season * cBKTStd * cBNTStd * cATSStd +
                   (1|ind), data = df ) }

mod[[13]] <- function(df) {
  print(c('mod = 13' ))
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear +
                   isYOY * season * cBKTStd * cBNTStd +
                   (1|ind), data = df ) } 
```

1  o$model11[[1]] 196 -24757.35 o$model13[[2]]   81 -11300.64 o$model12[[3]]   81 -29435.49
2   o$model8[[1]] 140 -24427.44  o$model9[[2]]   67 -11258.70 o$model11[[3]]   53 -28160.01
3  o$model13[[1]] 156 -24407.24  o$model8[[2]]   67 -11227.08 o$model13[[3]]   53 -27792.61
4  o$model12[[1]] 188 -24354.95 o$model11[[2]]   95 -11217.75  o$model8[[3]]   39 -27393.12
5   o$model3[[1]] 132 -24138.75 o$model10[[2]]   67 -11204.81  o$model5[[3]]   53 -27273.26
6   o$model9[[1]] 140 -24119.50  o$model3[[2]]   60 -11185.96  o$model4[[3]]   46 -27271.94
7  o$model10[[1]] 140 -24084.14  o$model7[[2]]   74 -11185.65  o$model9[[3]]   39 -26895.35
8   o$model1[[1]] 130 -24066.23 o$model12[[2]]  109 -11148.99  o$model7[[3]]   39 -26891.76
9   o$model2[[1]] 131 -24051.02  o$model6[[2]]   74 -11140.56  o$model6[[3]]   39 -26866.52
10  o$model6[[1]] 164 -24031.80  o$model4[[2]]   88 -11113.99 o$model10[[3]]   39 -26735.14
11  o$model5[[1]] 226 -23972.19  o$model1[[2]]   58 -11093.02  o$model3[[3]]   32 -26711.17
12  o$model7[[1]] 164 -23945.62  o$model2[[2]]   59 -11076.95  o$model1[[3]]   30 -26675.04
13  o$model4[[1]] 196 -23919.37  o$model5[[2]]  102 -11021.51  o$model2[[3]]   31 -26664.86 
```{r}
mod[[14]] <- function(df) {
    print(c('mod = 14' ))
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear  +
                   isYOY * river * season * cBKTStd * tempStd * flowStd +
                   isYOY * river * season * cBNTStd * tempStd * flowStd +
                   isYOY *         season * cATSStd * tempStd * flowStd +
                   
                   (1|ind), data = df ) }

mod[[15]] <- function(df) {
    print(c('mod = 15' ))
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear  +
                   isYOY * river * season * cBKTStd +
                   isYOY * river * season * cBNTStd +
                   isYOY *         season * cATSStd +
                   isYOY * river * season * cBKTStd * tempStd +
                   isYOY * river * season * cBNTStd * tempStd +
                   isYOY *         season * cATSStd * tempStd +
                   isYOY * river * season * cBKTStd * flowStd +
                   isYOY * river * season * cBNTStd * flowStd +
                   isYOY *         season * cATSStd * flowStd +

                   (1|ind), data = df ) }

mod[[16]] <- function(df) {
    print(c('mod = 16' ))
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear  +
                   isYOY * river * season * cBKTStd +
                   isYOY * river * season * cBNTStd +
                   isYOY *         season * cATSStd +
                   isYOY * river * season * cBKTStd * tempStd +
                   isYOY * river * season * cBNTStd * tempStd +
                   isYOY *         season * cATSStd * tempStd +
                   (1|ind), data = df ) }

mod[[17]] <- function(df) {
    print(c('mod = 17' ))
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear  +
                   isYOY * river * season * cBKTStd +
                   isYOY * river * season * cBNTStd +
                   isYOY *         season * cATSStd +
                   isYOY * river * season * cBKTStd * flowStd +
                   isYOY * river * season * cBNTStd * flowStd +
                   isYOY *         season * cATSStd * flowStd +
                   (1|ind), data = df ) }

mod[[18]] <- function(df) {
    print(c('mod = 18' ))
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear  +
                   isYOY * river * season * cBKTStd +
                   isYOY * river * season * cBNTStd +
                   isYOY *         season * cATSStd * ATS01DATA +
                   (1|ind), data = df ) }
```

1  o$model11[[1]] 196 -24757.35 o$model13[[2]]   81 -11300.64 o$model12[[3]]   81 -29435.49
2  o$model16[[1]] 258 -24687.75  o$model9[[2]]   67 -11258.70 o$model14[[3]]  116 -29023.66
3  o$model14[[1]] 378 -24667.16  o$model8[[2]]   67 -11227.08 o$model15[[3]]   95 -28852.96
4  o$model17[[1]] 258 -24658.77 o$model11[[2]]   95 -11217.75 o$model16[[3]]   74 -28765.54
5  o$model15[[1]] 319 -24637.70 o$model10[[2]]   67 -11204.81 o$model17[[3]]   74 -28385.96
6   o$model8[[1]] 140 -24427.44  o$model3[[2]]   60 -11185.96 o$model11[[3]]   53 -28160.01
7  o$model13[[1]] 156 -24407.24  o$model7[[2]]   74 -11185.65 o$model13[[3]]   53 -27792.61
8  o$model18[[1]] 164 -24402.75 o$model17[[2]]  130 -11178.95 o$model18[[3]]   53 -27529.84
9  o$model12[[1]] 188 -24354.95 o$model18[[2]]   88 -11160.65  o$model8[[3]]   39 -27393.12
10  o$model3[[1]] 132 -24138.75 o$model12[[2]]  109 -11148.99  o$model5[[3]]   53 -27273.26
11  o$model9[[1]] 140 -24119.50  o$model6[[2]]   74 -11140.56  o$model4[[3]]   46 -27271.94
12 o$model10[[1]] 140 -24084.14  o$model4[[2]]   88 -11113.99  o$model9[[3]]   39 -26895.35
13  o$model1[[1]] 130 -24066.23  o$model1[[2]]   58 -11093.02  o$model7[[3]]   39 -26891.76
14  o$model2[[1]] 131 -24051.02 o$model16[[2]]  130 -11088.10  o$model6[[3]]   39 -26866.52
15  o$model6[[1]] 164 -24031.80  o$model2[[2]]   59 -11076.95 o$model10[[3]]   39 -26735.14
16  o$model5[[1]] 226 -23972.19 o$model15[[2]]  164 -11076.43  o$model3[[3]]   32 -26711.17
17  o$model7[[1]] 164 -23945.62  o$model5[[2]]  102 -11021.51  o$model1[[3]]   30 -26675.04
18  o$model4[[1]] 196 -23919.37 o$model14[[2]]  196 -11020.01  o$model2[[3]]   31 -26664.86


```{r}

mod[[19]] <- function(df) {
    print(c('mod = 19' ))
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * lengthByYear  +
                   isYOY * river * season * cBKTStd * lengthByYear +
                   isYOY * river * season * cBNTStd * lengthByYear +
                   isYOY *         season * cATSStd * lengthByYear  +

                   (1|ind), data = df ) }

mod[[20]] <- function(df) {
 lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                  isYOY * lengthByYear  +
                  isYOY * river * season * cBKTStd +
                  isYOY * river * season * cBNTStd +
                  isYOY *         season * cATSStd +
                  isYOY * river * season * tempStd^2  +
                  isYOY * river * season * flowStd^2  +
                  (1|ind), data = df ) }

```

```{r}


bySpecies <- bySpecies %>%
      mutate( model1 =  map(data, mod[[1]]) ) %>%
      mutate( model2 =  map(data, mod[[2]]) ) %>%
      mutate( model3 =  map(data, mod[[3]]) ) %>%
      mutate( model4 =  map(data, mod[[4]]) ) %>%
      mutate( model5 =  map(data, mod[[5]]) ) %>%
      mutate( model6 =  map(data, mod[[6]]) ) %>%
      mutate( model7 =  map(data, mod[[7]]) ) %>%
     mutate( model8 =  map(data, mod[[8]]) ) %>%
     mutate( model9 =  map(data, mod[[9]]) ) %>%
     mutate( model10 = map(data, mod[[10]]) ) %>%
     mutate( model11 = map(data, mod[[11]]) ) %>%
     mutate( model12 = map(data, mod[[12]]) ) %>%
     mutate( model13 = map(data, mod[[13]]) ) %>%
      mutate( model14 = map(data, mod[[14]]) ) %>%
      mutate( model15 = map(data, mod[[15]]) ) %>%
      mutate( model16 = map(data, mod[[16]]) ) %>%
      mutate( model17 = map(data, mod[[17]]) ) %>%
      mutate( model18 = map(data, mod[[18]]) ) %>%
     mutate( model19 = map(data, mod[[19]]) ) %>%
      mutate( model20 = map(data, mod[[20]])) #%>%
     # mutate( model21 = map(data, mod[[21]])) %>%
    #  mutate( model22 = map(data, mod[[22]])) %>%
    #  mutate( model23 = map(data, mod[[23]]))
               
         

#2 or 5 fish have lengthByYear = NA whcih gives warining of diff # of observations when include mod with lengthByYear

o <- bySpecies
b <- AIC(o$model1[[1]],
         o$model2[[1]],
         o$model3[[1]],
         o$model4[[1]],
         o$model5[[1]],
         o$model6[[1]],
         o$model7[[1]],
         o$model8[[1]],
         o$model9[[1]],
         o$model10[[1]],
         o$model11[[1]],
         o$model12[[1]],
         o$model13[[1]],
           o$model14[[1]],
           o$model15[[1]],
           o$model16[[1]],
           o$model17[[1]],
           o$model18[[1]],
          o$model19[[1]],
          o$model20[[1]]
         # o$model21[[1]],
         # o$model22[[1]],
         # o$model23[[1]]
         ) %>% rownames_to_column() %>% arrange(AIC) #bkt
n <- AIC(o$model1[[2]],
         o$model2[[2]],
         o$model3[[2]],
         o$model4[[2]],
         o$model5[[2]],
         o$model6[[2]],
         o$model7[[2]],
         o$model8[[2]],
         o$model9[[2]],
         o$model10[[2]],
         o$model11[[2]],
         o$model12[[2]],
         o$model13[[2]],
           o$model14[[2]],
           o$model15[[2]],
           o$model16[[2]],
           o$model17[[2]],
           o$model18[[2]],
          o$model19[[2]],
          o$model20[[2]]
         # o$model21[[2]],
         # o$model22[[2]],
         # o$model23[[2]]
         ) %>% rownames_to_column() %>% arrange(AIC)#bnt
a <- AIC(o$model1[[3]],
         o$model2[[3]],
         o$model3[[3]],
         o$model4[[3]],
         o$model5[[3]],
         o$model6[[3]],
         o$model7[[3]],
         o$model8[[3]],
         o$model9[[3]],
         o$model10[[3]],
         o$model11[[3]],
         o$model12[[3]],
         o$model13[[3]],
           o$model14[[3]],
           o$model15[[3]],
           o$model16[[3]],
           o$model17[[3]],
           o$model18[[3]],
           o$model19[[3]],
          o$model20[[3]]
         # o$model21[[3]],
         # o$model22[[3]],
         # o$model23[[3]]
          ) %>% rownames_to_column() %>% arrange(AIC)#ats

(all <- data.frame(b,n,a))

```

```{r}

#d[d==-2.5] <- 0


#ftable(d$isYOY,d$species,d$river,d$season,d$year)
tmp1 <- 
 lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                  isYOY * season * cBKTStd * cBNTStd * cATSStd +

   (1|ind) + (1|river), data = bySpecies$data[[1]] )



tmp2 <- 
 lmer( grLength ~ isYOY * river * season * cBKTStd +
                  isYOY * river * season * cBNTStd  +
                  isYOY * season * cATSStd  +
         
       #  
      #            isYOY * river * season * cBNTStd * tempStd * flowStd+
               #   isYOY *         season * cATSStd * tempStd * flowStd +

   (1|ind) , data = bySpecies$data[[1]]) #bySpecies$data[[1]] )

tmp3 <- 
 lmer( grLength ~ isYOY * river * season * cBKTStd +
                  isYOY * river * season * cBNTStd +
                  isYOY * river * season * cATSStd  +
                  isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
         cBKTStd * cBNTStd * cATSStd * tempStd * flowStd +
                   # isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                   # isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                   # isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
          
                  # isYOY * river * season * ( tempStd2 * flowStd2 ) + 
                  # 
                 #  isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBKT2_01 ) +
                 #  isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBNT2_01 ) +
                #   isYOY * river * season * ( tempStd2 * flowStd2 * countPStdATS2_01 ) +
                  # # isYOY * river * season * ( tempStd2 * flowStd2 * length2 ) + # model error with this line in
                  # isYOY * river * season * ( length2 * countPStdBKT2 ) +
                  # isYOY * river * season * ( length2 * countPStdBNT2 ) +
                  # isYOY * river * season * ( length2 * countPStdATS2 ) + 

   (1|ind), data = bySpecies$data[[1]] )#bySpecies$data[[2]] )

tmp4 <- 
 lmer( grLength ~  isYOY * river * season * tempStd * flowStd  +
                   #isYOY * river * season * tempStd2 * flowStd2  +
                   isYOY * season * cBKTStd * cBNTStd * cATSStd +
                   isYOY * season * cBKTStd2 * cBNTStd2 * cATSStd2 +


   (1|ind) , data = bySpecies$data[[2]] )#bySpecies$data[[2]] )

x <- model.matrix(~ isYOY * river * season * tempStd * flowStd  +
                   #isYOY * river * season * tempStd2 * flowStd2  +
                   isYOY * season * cBKTStd * cBNTStd * cATSStd +
                   isYOY * season * cBKTStd2 * cBNTStd2 * cATSStd2 +
   (1|ind) , data = bySpecies$data[[2]])


xx <- findLinearCombos((x))
getBadCols <- function(col){
  cols <- xx$linearCombos[[col]]
  badCols1 <- x[,cols]
  badCols <- dimnames(badCols1)[[2]]
  return(badCols)
}

getBadCols(41)

# removed dimnames
dimnames(x)[[2]][xx$remove]

d %>% filter(species==1, river==4) %>% select(cATSStd) %>% distinct()



AIC(tmp1,tmp2,tmp3) %>% rownames_to_column() %>% arrange(AIC)

ggplot(d%>%filter(species==2), aes(lengthByYear,grLength, color=isYOY)) + geom_point() + geom_smooth(method='lm') + facet_grid(isYOY+river~season)
ggplot(d%>%filter(species==2), aes(flowStd,grLength, color=isYOY)) + geom_point() + geom_smooth(method='lm') + facet_grid(isYOY~season)

ggplot(d%>%filter(species==2), aes(lengthByYear,countPStdATS, color=isYOY)) + geom_point() + geom_smooth(method='lm') + facet_grid(isYOY~season)

d%>%filter(species==2 & season==2 &isYOY==1)

d$countPStdATS <- ifelse(d$species %in% c('2') & d$isYOY == 1 & d$season == "2", NA, d$countPStdATS)
d$countPStdATS <- ifelse( d$river %in% c("3","4"), NA, d$countPStdATS)

d$cBNTStd <- ifelse(d$river %in% c('4') , NA, d$cBNTStd)
d$countPStdATS <- ifelse( d$river %in% c("3","4"), NA, d$countPStdATS)
```

```{r}


mod[[1]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * season * cBKTStd * cBNTStd * cATSStd +

                   (1|ind), data = df ) }

mod[[2]] <- function(df) {
 lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                  isYOY * river * season * cBKTStd +
                  isYOY * river * season * cBNTStd +
                  isYOY * river * season * cBNTStd +

                  (1|ind), data = df ) }

mod[[3]] <- function(df) {
  lmer( grLength ~ isYOY * river * season * tempStd * flowStd  +
                   isYOY * season * cBKTStd * cBNTStd +

                   (1|ind), data = df ) } 

#mod[[4]] <- function(df) {
#  lmer( grLength ~ isYOY * river * season * cBKTStd * cBKTStd * cBKTStd +

#                   (1|ind), data = df ) }


mod[[5]] <- function(df) { lmer( grLength ~ isYOY * river * season * ( tempStd * flowStd * countPStdBKT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdBNT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdATS_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
                
                         isYOY * river * season * ( tempStd2 * flowStd2 ) +
                         isYOY * river * season * ( countPStdBNT2_01 ) +
                         # isYOY * river * season * ( tempStd2 * flowStd2 * countPStdATS2_01 ) +
                         # # isYOY * river * season * ( tempStd2 * flowStd2 * lengthByYear2 ) + # model error with this line in
                         # isYOY * river * season * ( lengthByYear2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdATS2_01 ) + 

                         (1|ind), data = df ) }

mod[[6]] <- function(df) { lmer( grLength ~ isYOY * river * season * ( tempStd * flowStd * countPStdBKT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdBNT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdATS_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
                         isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                         isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                         isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
                
                         # isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( tempStd2 * flowStd2 * countPStdATS2_01 ) +
                         # # isYOY * river * season * ( tempStd2 * flowStd2 * lengthByYear2 ) + # model error with this line in
                         # isYOY * river * season * ( lengthByYear2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdATS2_01 ) + 

                         (1|ind), data = df ) }

mod[[7]] <- function(df) { lmer( grLength ~ isYOY * river * season * ( tempStd * flowStd * countPStdBKT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdBNT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdATS_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
                         isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                         isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                         isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
                
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBKT2_01 ) +
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBNT2_01 ) +
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdATS2_01 ) +
                         # # isYOY * river * season * ( tempStd2 * flowStd2 * lengthByYear2 ) + # model error with this line in
                         # isYOY * river * season * ( lengthByYear2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdATS2_01 ) + 

                         (1|ind), data = df ) }

mod[[8]] <- function(df) { lmer( grLength ~ isYOY * river * season * ( tempStd * flowStd * countPStdBKT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdBNT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdATS_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
                         isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                         isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                         isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
                
                         isYOY * river * season * ( tempStd2 * flowStd2  ) +
                         isYOY * river * season * ( tempStd2 * flowStd2  ) +
                         isYOY * river * season * ( tempStd2 * flowStd2  ) +
                         # # isYOY * river * season * ( tempStd2 * flowStd2 * lengthByYear2 ) + # model error with this line in
                         # isYOY * river * season * ( lengthByYear2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdATS2_01 ) + 

                         (1|ind), data = df ) }


mod[[9]] <- function(df) { lmer( grLength ~ isYOY * river * season * ( tempStd * flowStd * countPStdBKT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdBNT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdATS_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
                
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBKT2_01 ) +
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBNT2_01 ) +
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdATS2_01 ) +
                         # # isYOY * river * season * ( tempStd2 * flowStd2 * lengthByYear2 ) + # model error with this line in
                         # isYOY * river * season * ( lengthByYear2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdATS2_01 ) + 

                         (1|ind), data = df ) }

mod[[10]] <- function(df) {  lmer( grLength ~ isYOY * river * season * ( tempStd * flowStd * countPStdBKT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdBNT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdATS_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
                
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBKT2_01 ) +
                        # isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBNT2_01 ) +
                        # isYOY * river * season * ( tempStd2 * flowStd2 * countPStdATS2_01 ) +
                         # # isYOY * river * season * ( tempStd2 * flowStd2 * lengthByYear2 ) + # model error with this line in
                         # isYOY * river * season * ( lengthByYear2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdATS2_01 ) + 

                         (1|ind), data = df ) }

mod[[11]] <- function(df) {  lmer( grLength ~ isYOY * river * season * ( tempStd * flowStd * countPStdBKT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdBNT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdATS_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
                
                       #  isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBKT2_01 ) +
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBNT2_01 ) +
                       #   isYOY * river * season * ( tempStd2 * flowStd2 * countPStdATS2_01 ) +
                         # # isYOY * river * season * ( tempStd2 * flowStd2 * lengthByYear2 ) + # model error with this line in
                         # isYOY * river * season * ( lengthByYear2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdATS2_01 ) + 

                         (1|ind), data = df ) }

mod[[12]] <- function(df) {  lmer( grLength ~ isYOY * river * season * ( tempStd * flowStd * countPStdBKT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdBNT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdATS_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
                
                        # isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBKT2_01 ) +
                       #  isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBNT2_01 ) +
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdATS2_01 ) +
                         # # isYOY * river * season * ( tempStd2 * flowStd2 * lengthByYear2 ) + # model error with this line in
                         # isYOY * river * season * ( lengthByYear2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdATS2_01 ) + 

                         (1|ind), data = df ) }

mod[[13]] <- function(df) {  lmer( grLength ~ isYOY * river * season * ( tempStd * flowStd * countPStdBKT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdBNT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdATS_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
                
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBKT2_01 ) +
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBNT2_01 ) +
                        # isYOY * river * season * ( tempStd2 * flowStd2 * countPStdATS2_01 ) +
                         # # isYOY * river * season * ( tempStd2 * flowStd2 * lengthByYear2 ) + # model error with this line in
                         # isYOY * river * season * ( lengthByYear2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdATS2_01 ) + 

                         (1|ind), data = df ) }

mod[[14]] <- function(df) {  lmer( grLength ~ isYOY * river * season * ( tempStd * flowStd * countPStdBKT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdBNT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdATS_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
                
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBKT2_01 ) +
                        # isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBNT2_01 ) +
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdATS2_01 ) +
                         # # isYOY * river * season * ( tempStd2 * flowStd2 * lengthByYear2 ) + # model error with this line in
                         # isYOY * river * season * ( lengthByYear2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdATS2_01 ) + 

                         (1|ind), data = df ) }

mod[[15]] <- function(df) {  lmer( grLength ~ isYOY * river * season * ( tempStd * flowStd * countPStdBKT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdBNT_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * countPStdATS_01 ) +
                         isYOY * river * season * ( tempStd * flowStd * lengthByYear ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBKT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdBNT_01 ) +
                         # isYOY * river * season * ( lengthByYear * countPStdATS_01 ) +                
                
                        # isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBKT2_01 ) +
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdBNT2_01 ) +
                         isYOY * river * season * ( tempStd2 * flowStd2 * countPStdATS2_01 ) +
                         # # isYOY * river * season * ( tempStd2 * flowStd2 * lengthByYear2 ) + # model error with this line in
                         # isYOY * river * season * ( lengthByYear2 * countPStdBKT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdBNT2_01 ) +
                         # isYOY * river * season * ( lengthByYear2 * countPStdATS2_01 ) + 

                         (1|ind), data = df ) }
 
  
```
